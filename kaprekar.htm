<!DOCTYPE html>
<!-- 
    (c)2022 by Araz Yusubov 
    DISCLAIMER: This code is a quick hack intended to present a working prototype.
    Hence it does not follow best practice of programming or software engineering.
-->
<html>
    <head><title>Kaprekar</title></head>
    <body>
        <script>
            var allnumbers = [];
            var reportlines = [];

            function getNumber(a) {
                if (Array.isArray(a)) {
                    return a.join('');
                } else {
                    return undefined;
                }
            }

            function lunchGenerate() {
                reportlines = [];
                let number = Number(document.getElementById("numInput").value);
                document.getElementById("txtOutput").value += "\nStart generating for "+ number; 
                Generate(number, 0, true);
                document.getElementById("txtOutput").value = reportlines.join('\n');
            }

            async function Generate(startnumber, idx, details) {
                let newnumber = startnumber;
                allnumbers = [];
                do {
                    // Add new number and icrement the index
                    allnumbers.push(newnumber);
                    idx++;
                    digits = Array.from(String(newnumber));
                    // Sort by ascending order
                    digits.sort(function(a, b){return b-a});
                    let number1 = getNumber(digits);
                    // Sort by descending order
                    digits.sort(function(a, b){return a-b});
                    let number2 = getNumber(digits);
                    // Calculate the next number;
                    number3 = number1 - number2;
                    // Add leading zeroes if needed
                    while (number3.toString().length < newnumber.toString().length) number3 = "0" + number3;
                    // Add new calculation line to the output
                    if (details) {
                        //document.getElementById("txtOutput").value += "\n"+ idx +": "+ number1 +"-"+ number2 +"="+ number3;
                        reportlines.push(idx +": "+ number1 +"-"+ number2 +"="+ number3);
                    }
                    newnumber = number3;
                } while ((!allnumbers.includes(number3)) && (idx < 100));
                //document.getElementById("txtOutput").value += "\n"+ startnumber +" "+ idx +": "+ number3 +" "+ allnumbers.includes(number3);
                let idx0 = allnumbers.indexOf(number3);
                reportlines.push(startnumber +" "+ idx +" "+ idx0 +" "+ (idx - idx0) +" "+ number3 +" "+ allnumbers.includes(number3));
                //console.log(startnumber);
            }

            function Clean() {
                document.getElementById("txtOutput").value = "";
            }

            function allGenerate() {
                Clean();
                for (var n = 100000; n <= 999999; n++) {
                    Generate(n, 0, false);
                }
                document.getElementById("txtOutput").value = reportlines.join('\n');

                // Create a hidden anchor element to activate file download
                var a = document.createElement("a");
                a.href = window.URL.createObjectURL(new Blob([reportlines.join('\n')], {type: "text/plain"}));
                a.download = "kaprekar.txt";
                a.click(); 
                
            }

        </script>
        <input id="numInput" type="number">
        <br>
        <textarea id="txtOutput" cols="50" rows="10">Kaprekar v1.4 (c) 2022 by Araz Yusubov</textarea>
        <br>
        <input id="btnCalculate" type="button" value="Calculate" onclick="lunchGenerate();">&nbsp;
        <input id="btnClean" type="button" value="Clean" onclick="Clean();">&nbsp;
        <input id="btnCalculateAll" type="button" value="Calculate for all 6-digit numbers" onclick="allGenerate();">
    </body>
</html>